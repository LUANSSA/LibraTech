{% extends "core/base.html" %}

{% block titulo_da_pagina %}
    Acervo - Arquivos
{% endblock %}

{% block conteudo %}
    <div class="d-flex justify-content-center align-items-center" style="min-height: 100vh; background-image: url('/static/images/sua-imagem.jpg'); background-size: cover; background-position: center; padding: 30px;">
        <div style="width: 100%; max-width: 900px;">
        
            {% if not arquivos.pk %}
                <h2 class="text-center mb-4">ðŸ“œ Cadastrar Arquivo</h2>
                <p class="text-center mb-4">Preencha os campos abaixo para adicionar um novo arquivo ao acervo.</p>
            {% else %}
                <h2 class="text-center mb-4">ðŸ“œ Editar Arquivo</h2>
                <p class="text-center mb-4">Atualize as informaÃ§Ãµes do arquivo conforme necessÃ¡rio.</p>
            {% endif %}

            <form method="POST" enctype="multipart/form-data" class="row g-3">
                {% csrf_token %}

                <!-- Linha 1 -->
                <div class="col-md-6">
                    <label for="{{ form.titulo.id_for_label }}" class="form-label"><b>{{ form.titulo.label }}</b></label>
                    <input type="text" name="{{ form.titulo.name }}" id="{{ form.titulo.id_for_label }}" value="{{ form.titulo.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="Digite o tÃ­tulo do arquivo" {% if form.titulo.required %}required{% endif %}>
                    {% for error in form.titulo.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-md-6">
                    <label for="{{ form.tipo_arquivo.id_for_label }}" class="form-label"><b>{{ form.tipo_arquivo.label }}</b></label>
                    <select name="{{ form.tipo_arquivo.name }}" id="{{ form.tipo_arquivo.id_for_label }}" class="form-control border border-dark" {% if form.tipo_arquivo.required %}required{% endif %}>
                        <option value="PDF" {% if form.tipo_arquivo.value == "PDF" %}selected{% endif %}>PDF</option>
                        <option value="DOCX" {% if form.tipo_arquivo.value == "DOCX" %}selected{% endif %}>Documento Word (.docx)</option>
                    </select>
                    {% for error in form.tipo_arquivo.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- Linha 2 -->
                <div class="col-md-6">
                    <label for="{{ form.colecao.id_for_label }}" class="form-label"><b>{{ form.colecao.label }}</b></label>
                    <input type="text" name="{{ form.colecao.name }}" id="{{ form.colecao.id_for_label }}" value="{{ form.colecao.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="ColeÃ§Ã£o do arquivo" {% if form.colecao.required %}required{% endif %}>
                    {% for error in form.colecao.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-md-6">
                    <label for="{{ form.autor.id_for_label }}" class="form-label"><b>{{ form.autor.label }}</b></label>
                    <input type="text" name="{{ form.autor.name }}" id="{{ form.autor.id_for_label }}" value="{{ form.autor.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="Autor do arquivo" {% if form.autor.required %}required{% endif %}>
                    {% for error in form.autor.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- Linha 3 -->
                {% comment %} <div class="col-md-6">
                    <label for="{{ form.arquivo.id_for_label }}" class="form-label"><b>{{ form.arquivo.label }}</b></label>
                    <input type="file" name="{{ form.arquivo.name }}" id="{{ form.arquivo.id_for_label }}" class="form-control border border-dark" {% if form.arquivo.required %}required{% endif %}>
                    {% for error in form.arquivo.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>
 {% endcomment %}


                <div class="mb-3">
                    <!-- Campo de Upload -->
                    <label for="arquivo" class="form-label"><b>Arquivo</b></label>
                    
                    <!-- Input de Arquivo -->
                    <div class="input-group">
                        <!-- Arquivo -->
                        <input type="file" class="form-control" id="arquivo" name="arquivo" accept="application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document, image/*">
                        
                        <!-- Ãcone de Arquivo -->
                        <div class="input-group-append">
                            {% if arquivos.arquivo %}
                                <!-- Mostrar botÃ£o apenas se o arquivo jÃ¡ existir -->
                                <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#visualizarArquivoModal">
                                    <i class="fas fa-file-alt"></i> Visualizar
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Modal para Visualizar Arquivo -->
                <div class="modal fade" id="visualizarArquivoModal" tabindex="-1" aria-labelledby="visualizarArquivoModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="visualizarArquivoModalLabel">Visualizar Arquivo</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {% if arquivos.arquivo %}
                                    {% with arquivos.arquivo.url|slice:-4 as ext %}
                                        {% if ext == ".pdf" %}
                                            <!-- Exibir PDF -->
                                            <embed src="{{ arquivos.arquivo.url }}" width="100%" height="500px" type="application/pdf">
                                        {% elif ext == ".jpg" or ext == ".png" or ext == ".jpeg" %}
                                            <!-- Exibir Imagem -->
                                            <img src="{{ arquivos.arquivo.url }}" class="img-fluid" alt="Arquivo Imagem">
                                        {% elif ext == ".docx" or ext == ".doc" %}
                                            <!-- Exibir Documento Word -->
                                            <a href="{{ arquivos.arquivo.url }}" target="_blank" class="btn btn-info">Abrir Documento</a>
                                        {% else %}
                                            <p>Este tipo de arquivo nÃ£o pode ser visualizado diretamente.</p>
                                        {% endif %}
                                    {% endwith %}
                                {% else %}
                                    <p>NÃ£o hÃ¡ arquivo para visualizar.</p>
                                {% endif %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            </div>
                        </div>
                    </div>
                </div>                

                
                <div class="col-md-6">
                    <label for="{{ form.assunto.id_for_label }}" class="form-label"><b>{{ form.assunto.label }}</b></label>
                    <input type="text" name="{{ form.assunto.name }}" id="{{ form.assunto.id_for_label }}" value="{{ form.assunto.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="Assunto do arquivo" {% if form.assunto.required %}required{% endif %}>
                    {% for error in form.assunto.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- Linha 4 -->
                <div class="col-md-6">
                    <label for="{{ form.area_acervo.id_for_label }}" class="form-label"><b>{{ form.area_acervo.label }}</b></label>
                    <input type="text" name="{{ form.area_acervo.name }}" id="{{ form.area_acervo.id_for_label }}" value="{{ form.area_acervo.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="Ãrea do acervo" {% if form.area_acervo.required %}required{% endif %}>
                    {% for error in form.area_acervo.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-md-6">
                    <label for="{{ form.chamada.id_for_label }}" class="form-label"><b>{{ form.chamada.label }}</b></label>
                    <input type="text" name="{{ form.chamada.name }}" id="{{ form.chamada.id_for_label }}" value="{{ form.chamada.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="Chamada do arquivo" {% if form.chamada.required %}required{% endif %}>
                    {% for error in form.chamada.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- Linha 5 -->
                <div class="col-md-6">
                    <label for="{{ form.num_tombamento.id_for_label }}" class="form-label"><b>{{ form.num_tombamento.label }}</b></label>
                    <input type="text" name="{{ form.num_tombamento.name }}" id="{{ form.num_tombamento.id_for_label }}" value="{{ form.num_tombamento.value|default_if_none:'' }}" class="form-control border border-dark" placeholder="NÃºmero de tombamento" {% if form.num_tombamento.required %}required{% endif %}>
                    {% for error in form.num_tombamento.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-md-6">
                    <label for="{{ form.data_publicacao.id_for_label }}" class="form-label"><b>{{ form.data_publicacao.label }}</b></label>
                    <input type="date" name="{{ form.data_publicacao.name }}" id="{{ form.data_publicacao.id_for_label }}" value="{{ form.data_publicacao.value|date:'Y-m-d'|default_if_none:'' }}" class="form-control border border-dark" {% if form.data_publicacao.required %}required{% endif %}>
                    {% for error in form.data_publicacao.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- Linha 6 -->
                <div class="col-12">
                    <label for="{{ form.descricao.id_for_label }}" class="form-label"><b>{{ form.descricao.label }}</b></label>
                    <textarea name="{{ form.descricao.name }}" id="{{ form.descricao.id_for_label }}" class="form-control border border-dark" rows="3" placeholder="DescriÃ§Ã£o do arquivo" {% if form.descricao.required %}required{% endif %}>{{ form.descricao.value|default_if_none:'' }}</textarea>
                    {% for error in form.descricao.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12">
                    <label for="{{ form.referencia_ABNT.id_for_label }}" class="form-label"><b>{{ form.referencia_ABNT.label }}</b></label>
                    <textarea name="{{ form.referencia_ABNT.name }}" id="{{ form.referencia_ABNT.id_for_label }}" class="form-control border border-dark" rows="3" placeholder="ReferÃªncia ABNT" {% if form.referencia_ABNT.required %}required{% endif %}>{{ form.referencia_ABNT.value|default_if_none:'' }}</textarea>
                    {% for error in form.referencia_ABNT.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <div class="col-12">
                    <label for="{{ form.nota.id_for_label }}" class="form-label"><b>{{ form.nota.label }}</b></label>
                    <textarea name="{{ form.nota.name }}" id="{{ form.nota.id_for_label }}" class="form-control border border-dark" rows="3" placeholder="Notas adicionais" {% if form.nota.required %}required{% endif %}>{{ form.nota.value|default_if_none:'' }}</textarea>
                    {% for error in form.nota.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- Checkbox -->
                <div class="col-md-6">
                    <div class="form-check">
                        <input type="checkbox" name="{{ form.disponibilidade.name }}" id="{{ form.disponibilidade.id_for_label }}" class="form-check-input" {% if form.disponibilidade.value %}checked{% endif %}>
                        <label for="{{ form.disponibilidade.id_for_label }}" class="form-check-label">{{ form.disponibilidade.label }}</label>
                    </div>
                    {% for error in form.disponibilidade.errors %}<div class="text-danger">{{ error }}</div>{% endfor %}
                </div>

                <!-- BotÃµes -->
                <div class="col-12 text-center mt-4">
                    {% if not arquivos.pk %}
                        <button type="submit" class="btn btn-success btn-sm">Cadastrar</button>
                    {% else %}
                        <button type="submit" class="btn btn-success btn-sm">Salvar</button>
                    {% endif %}
                    <a href="javascript:history.back()" class="btn btn-secondary btn-sm">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
{% endblock conteudo %}
